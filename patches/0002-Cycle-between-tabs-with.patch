From 04b8440c9e8043c52837cb7c0183b16e7ed71896 Mon Sep 17 00:00:00 2001
From: Kafva <kafva.one@gmail.com>
Date: Mon, 1 Dec 2025 06:36:45 +0100
Subject: [PATCH 1/1] =?UTF-8?q?Cycle=20between=20tabs=20with=20=C3=A4/?=
 =?UTF-8?q?=C3=B6?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

There is an API for regular plugins to switch tabs:

    chrome.tabs.update(newTab.id, { active: true });

However, "chrome" does not appear to be available in pdf.js when it is
running in Firefox. The workaround in this patch hardwires global
mappings for switching tabs and an additional key to disable the special
behaviour. Note that ä/ö input will still be sent to focused text input
fields.
---
 modules/libpref/init/all.js           |  4 ++++
 toolkit/modules/ShortcutUtils.sys.mjs | 29 +++++++++++++++++++++++++++
 2 files changed, 33 insertions(+)

diff --git a/modules/libpref/init/all.js b/modules/libpref/init/all.js
index 430279363acf..d76135b242b3 100644
--- a/modules/libpref/init/all.js
+++ b/modules/libpref/init/all.js
@@ -4116,3 +4116,7 @@ pref("captchadetection.actor.enabled", true);
 // Make general.smoothScroll sticky to avoid being clobbered by
 // preferes-reduced-motion system setting.
 pref("general.smoothScroll", true, sticky);
+
+// Custom tab switch shortcuts
+pref("browser.tab_switch.active", false);
+pref("browser.tab_switch.time", 0);
diff --git a/toolkit/modules/ShortcutUtils.sys.mjs b/toolkit/modules/ShortcutUtils.sys.mjs
index 3e796cb6586a..489b9f58f1c3 100644
--- a/toolkit/modules/ShortcutUtils.sys.mjs
+++ b/toolkit/modules/ShortcutUtils.sys.mjs
@@ -344,6 +344,35 @@ export var ShortcutUtils = {
       !event.shiftKey &&
       !event.ctrlKey;
 
+    // HACK: use `.time` preference to avoid multiple triggers from one keypress
+    let now = Math.floor(Date.now() / 1000);
+    let tabSwitchActive = Services.prefs.getBoolPref("browser.tab_switch.active", false);
+    let tabSwitchLastSet = Services.prefs.getIntPref("browser.tab_switch.time", 0);
+
+    // Note: "'" has the same keyCode as "ä"
+    // Note: the 'key' field differs when modifier keys are present.
+    switch (event.key) {
+      case '\xE5': // macOS: key=\xE5 keyCode=219
+        if (event.shiftKey && meaningfulMetaKey && now > (tabSwitchLastSet + 2)) {
+            Services.prefs.setIntPref("browser.tab_switch.time", now);
+            Services.prefs.setBoolPref("browser.tab_switch.active", !tabSwitchActive);
+            console.log(`browser.tab_switch.active = ${!tabSwitchActive}`)
+        } else {
+            console.log(`no switch: ${now} ${tabSwitchLastSet}`);
+        }
+        return null;
+        case 'ö': // macOS: key=\xF6 keyCode=59
+        if (tabSwitchActive) {
+            return ShortcutUtils.PREVIOUS_TAB;
+        }
+        break;
+      case 'ä': // macOS: key=\xE4 keyCode=222
+        if (tabSwitchActive) {
+            return ShortcutUtils.NEXT_TAB;
+        }
+        break;
+    }
+
     switch (event.keyCode) {
       case event.DOM_VK_TAB:
         if (event.ctrlKey && !event.altKey && !meaningfulMetaKey) {
-- 
2.52.0

